{% extends "layout.html" %}
{% block title %}Manage Users{% endblock %}

{% block styles %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
<style>
    /* Your existing styles */
    .actions-cell {
        white-space: nowrap;
    }

    /* --- FINAL, CORRECTED CSS FOR PAGINATION --- */
    /* This targets the <ul> element that Bootstrap uses for pagination */
    .dataTables_wrapper .pagination {
        display: flex !important; /* !important ensures this rule wins */
        justify-content: flex-end;
        padding-left: 0;
        list-style: none; /* Removes the dots */
        margin: 0;
    }

    /* Target the links inside the pagination buttons for consistent styling */
    .dataTables_wrapper .paginate_button a {
        padding: 0.5rem 0.9rem;
        margin: 0 3px;
        border-radius: 0.25rem;
        transition: all 0.2s ease;
        border: 1px solid transparent; /* Start with a transparent border */
    }
    
    /* Style for non-active, non-disabled buttons */
    .dataTables_wrapper .paginate_button:not(.active) a {
        border-color: #dee2e6;
    }

    /* Hover effect */
    .dataTables_wrapper .paginate_button:not(.disabled) a:hover {
        background-color: #e9ecef;
        text-decoration: none;
        color: #5a8dab;
    }

    /* Style for the currently active page number */
    .dataTables_wrapper .paginate_button.active a {
        background-color: #5a8dab;
        border-color: #6F9FB8;
        color: white;
    }
    
    /* Style for disabled buttons (e.g., 'Previous' on the first page) */
    .dataTables_wrapper .paginate_button.disabled a {
        color: #6c757d;
        pointer-events: none; /* Makes the link unclickable */
        background-color: transparent;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Manage Users</h1>
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-info">Back to Dashboard</a>
</div>

<div class="card p-4 mb-4">
    <h3 class="mb-3">Students</h3>
    <form class="search-bar" onsubmit="return false;">
        <input type="text" class="form-control" placeholder="Search students..." id="search_student_input">
    </form>
    <div class="table-responsive mt-3">
        <table class="table table-striped table-hover" id="student-table" style="width:100%">
            <thead>
                <tr>
                    <th style="width: 6%;">ID</th>
                    <th>Full Name</th>
                    <th>Username</th>
                    <th>Stream</th>
                    <th>Semester</th>
                    <th>Status</th>
                    <th class="text-center" style="width: 15%;">Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div class="card p-4 mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">Faculty</h3>
    </div>
    <form class="search-bar" onsubmit="return false;">
        <input type="text" class="form-control" placeholder="Search faculty..." id="search_faculty_input">
    </form>
    <div class="table-responsive mt-3">
        <table class="table table-striped table-hover" id="faculty-table" style="width:100%">
             <thead>
                <tr>
                    <th style="width: 6%;">ID</th>
                    <th>Full Name</th>
                    <th>Username</th>
                    <th>Subject</th>
                    <th class="text-center" style="width: 15%;">Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div class="card p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">Admins</h3>
        <a href="{{ url_for('add_admin') }}" class="btn btn-primary btn-sm">Add Admin</a>
    </div>
     <form class="search-bar" onsubmit="return false;">
        <input type="text" class="form-control" placeholder="Search admins..." id="search_admin_input">
    </form>
    <div class="table-responsive mt-3">
        <table class="table table-striped table-hover" id="admin-table" style="width:100%">
            <thead>
                <tr>
                    <th style="width: 6%;">ID</th>
                    <th>Full Name</th>
                    <th>Username</th>
                    <th class="text-center" style="width: 15%;">Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
<script>
$(document).ready(function() {
    
    const studentTable = $('#student-table').DataTable({
        "ajax": { "url": "{{ url_for('search_users') }}?type=student", "dataSrc": "" },
        "columns": [
            { "data": "id" }, { "data": "full_name" }, { "data": "username" },
            { "data": "stream", "defaultContent": "N/A" }, { "data": "sem", "defaultContent": "N/A" },
            { "data": "is_approved", "searchable": false, "render": function(data) { return data ? '<span class="badge bg-success">Approved</span>' : '<span class="badge bg-warning text-dark">Pending</span>'; }},
            { "data": null, "className": "actions-cell text-center", "orderable": false, "searchable": false, "render": function(data, type, row) {
                return `<a href="/admin/edit_user/${row.role}/${row.id}" class="btn btn-sm btn-warning">Edit</a>
                        <form action="/admin/delete_user/${row.role}/${row.id}" method="POST" style="display:inline;" onsubmit="return confirm('Do you really want to delete this student record ?');"><button type="submit" class="btn btn-danger">Delete</button></form>`;
            }}
        ],
        "dom": 'rt<"d-flex justify-content-between mt-5"ip>'
    });
    $('#search_student_input').on('keyup', function() {
        studentTable.search(this.value).draw();
    });

    const facultyTable = $('#faculty-table').DataTable({
        "ajax": { "url": "{{ url_for('search_users') }}?type=faculty", "dataSrc": "" },
        "columns": [
            { "data": "id" }, { "data": "full_name" }, { "data": "username" },
            { "data": "subject", "defaultContent": "N/A" },
            { "data": null, "className": "actions-cell text-center", "orderable": false, "searchable": false,"render": function(data, type, row) {
                return `<a href="/admin/edit_user/${row.role}/${row.id}" class="btn btn-sm btn-warning">Edit</a>
                        <form action="/admin/delete_user/${row.role}/${row.id}" method="POST" style="display:inline;" onsubmit="return confirm('Do you really want to delete this faculty record ?');"><button type="submit" class="btn btn-danger">Delete</button></form>`;
            }}
        ],
        "dom": 'rt<"d-flex justify-content-between mt-5"ip>'
    });
    $('#search_faculty_input').on('keyup', function() {
        facultyTable.search(this.value).draw();
    });

    const adminTable = $('#admin-table').DataTable({
        "ajax": { "url": "{{ url_for('search_users') }}?type=admin", "dataSrc": "" },
        "columns": [
            { "data": "id" }, { "data": "full_name" }, { "data": "username" },
            { "data": null, "className": "actions-cell text-center", "orderable": false, "searchable": false, "render": function(data, type, row) {
                return `<a href="/admin/edit_user/${row.role}/${row.id}" class="btn btn-sm btn-warning">Edit</a>
                        <form action="/admin/delete_user/${row.role}/${row.id}" method="POST" style="display:inline;" onsubmit="return confirm('Do you really want to delete this admin record ?');"><button type="submit" class="btn btn-danger">Delete</button></form>`;
            }}
        ],
        "dom": 'rt<"d-flex justify-content-between mt-5"ip>'
    });
    $('#search_admin_input').on('keyup', function() {
        adminTable.search(this.value).draw();
    });
});
</script>
{% endblock %}